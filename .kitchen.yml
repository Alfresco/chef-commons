# When editing this file, remember that http://www.yamllint.com is your friend :-)
---

<% if ENV['KITCHEN_AWS'] %>
driver:
  # On-demand price for m1.small is 0.047, we can bid up to 4x this price
  # price: 0.188
  name: ec2
  # Official CentOS 7 (x86_64) with Updates HVM
  image_id: ami-96a818fe
  username: centos
  flavor_id: m3.medium
  aws_ssh_key_id: <%= ENV['KEYPAIR_NAME'] %>
  ssh_key: <%= ENV['AWS_KEY_PATH'] %>
  aws_access_key_id: <%= ENV['AWS_ACCESS_KEY_ID'] %>
  aws_secret_access_key: <%= ENV['AWS_SECRET_ACCESS_KEY'] %>
  region: us-east-1
  require_chef_omnibus: true
  security_group_ids: ['default','packer_ssh_in']
<% else %>
driver_plugin: vagrant
use_vagrant_berkshelf_plugin: true
<% end %>

provisioner:
  name: chef_zero

platforms:
  - name: centos-7.0
    driver:
      box_url: http://opscode-vm-bento.s3.amazonaws.com/vagrant/virtualbox/opscode_centos-7.0_chef-provisionerless.box
    # driver_config:
    #   require_chef_omnibus: 12.4.1

suites:
  - name: default
    run_list:
      - recipe[genius::awscli]
      - recipe[genius::ec2-tag]
      - recipe[genius::ec2-discover]
    data_bags_path: "test/integration/data_bags"
    attributes: {
      "name": "chef-genius-local",
      "hostname": "chef-genius-local",
      "genius" : {
        "awscli" : {
          "credentials_databag" : "aws",
          "credentials_databag_item" : "test"
        },
        "ec2" : {
          "peers_file_path" : "/tmp/ec2-peers.json",
          # Just to print out messages
          # TODO - spin off an EC2 box and run tests against it
          "aws_bin" : "echo aws",
          # "box_tags" : {
          #   "Status" : "complete",
          #   "StackName" : "stack1"
          # },
          # "query_tags" : {
          #   "Status" : "complete",
          #   "StackName" : "stack1"
          # }
        }
      }
    }
  # - name: misc
  #   run_list:
  #     - recipe[genius::ec2-tag]
  #     - recipe[genius::ec2-discover]
  #   data_bags_path: "test/integration/data_bags"
  #   attributes: {
  #     "name": "chef-genius-local",
  #     "hostname": "chef-genius-local",
  #     "artifact-deployer" : {
  #       "maven" : {
  #         "timeout" : 1500,
  #         "repositories" : {
  #           "private" : {
  #             "url" : "https://artifacts.alfresco.com/nexus/content/groups/private",
  #             "username" : "<%= ENV['NEXUS_USERNAME'] %>",
  #             "password" : "<%= ENV['NEXUS_PASSWORD'] %>"
  #           }
  #         }
  #       }
  #     },
  #     # TODO - still to implement as a recipe
  #     "certs" : {
  #       "ssl_databag" : "ssl",
  #       "ssl_databag_item" : "local"
  #     }
  #   }
